# 风机叶片视频预处理系统

这是一个基于Streamlit的风机叶片视频预处理系统，用于处理无人机采集的M4V/MP4视频，执行畸变校正、背景冻结稳像以及等时图像提取或帧序列输出。

## 功能特性

- 🎥 视频畸变校正
- 🎬 视频稳像处理（可选）
- ✂️ 等时图像切割或连续帧序列输出
- 🌐 现代化的Web界面
- 📁 支持大文件上传（最大2GB）
- 🔄 双输出模式：图像文件或内存帧序列

## 本地部署步骤

### 1. 环境要求

- Python 3.7+
- pip
- 推荐使用虚拟环境

### 2. 克隆或下载项目

将Frontend文件夹的内容下载到本地。

### 3. 安装依赖

打开命令提示符或终端，导航到Frontend文件夹，然后运行：

```bash
# 如果使用虚拟环境，先激活
# Windows:
.venv\Scripts\activate

# 然后安装依赖
pip install -r requirements.txt
```

### 4. 运行应用

在Frontend文件夹中运行以下命令：

```bash
# Windows PowerShell
streamlit run app.py --server.maxUploadSize=2048

# 或使用完整路径
& .venv\Scripts\streamlit.exe run app.py --server.maxUploadSize=2048
```

**参数说明：**
- `--server.maxUploadSize=2048`: 设置最大上传文件大小为2048MB（约2GB）
- 可根据需要调整数值，例如 `--server.maxUploadSize=1024` 为1GB

### 5. 访问应用

应用启动后，在浏览器中访问显示的本地URL，通常是：
- **本地URL**: http://localhost:8501
- **网络URL**: http://10.196.233.100:8501 (可在局域网访问)

## 使用说明

### 基本操作步骤：

1. **配置参数**：
   - 在侧边栏设置相机内参矩阵 (fx, fy, cx, cy)
   - 设置畸变系数 (k1, k2, p1, p2, k3)
   - 选择处理模式和参数

2. **选择输出模式**：
   - **保存图像文件**: 生成JPG图像序列和ZIP压缩包
   - **返回帧序列**: 输出内存中的帧列表，用于后续分析

3. **设置输出路径**：
   - 指定本地文件夹路径用于保存结果

4. **上传视频**：
   - 支持 .m4v, .mp4, .mov 格式
   - 最大支持2GB文件

5. **开始处理**：
   - 点击"🚀 开始处理"按钮
   - 实时查看处理进度和日志

6. **获取结果**：
   - 图像模式：下载ZIP压缩包或查看输出文件夹
   - 帧序列模式：数据存储在内存中，可用于振动分析

## 输出格式说明

### 图像文件模式
- **文件格式**: JPG (95%质量)
- **命名规则**: `frame_{帧号:06d}_t{时间戳:.2f}s.jpg`
- **存储位置**: `输出文件夹/视频名_时间戳/`
- **压缩包**: 可选生成ZIP文件

### 帧序列模式
- **数据类型**: `list[np.ndarray]` (OpenCV BGR格式)
- **帧率信息**: `float` (FPS)
- **用途**: 直接输入到Backend振动分析模块

## 注意事项

- 处理大视频文件时需要足够的内存和存储空间
- 如果处理速度慢，可以取消勾选"启用视频稳像"选项
- 确保输出文件夹路径存在且有写入权限
- 帧序列模式会占用较多内存，不适合超长视频

## 技术栈

- **Streamlit**: Web界面框架
- **OpenCV**: 视频处理和计算机视觉
- **NumPy**: 数值计算
- **tempfile**: 临时文件管理

## 故障排除

### 常见问题：

1. **无法启动应用**：
   - 检查Python版本 (需要3.7+)
   - 确认依赖已正确安装
   - 尝试重新创建虚拟环境

2. **上传文件失败**：
   - 检查文件大小是否超过限制
   - 确认文件格式支持 (.m4v, .mp4, .mov)

3. **处理速度慢**：
   - 启用"快速模式"
   - 关闭视频稳像
   - 增加时间间隔

4. **内存不足**：
   - 使用图像文件模式而不是帧序列
   - 处理较短的视频片段

## 许可证

本项目用于风机叶片健康监测研究。