# 振动分析可视化界面使用说明

## 📋 功能概述

`analyzer.py` 是一个完整的振动分析可视化界面，它能够：
1. 接收Frontend生成的npz文件
2. 自动调用Backend进行图像分析和信号分析
3. 可视化展示分析结果（时域图、频域图、统计信息）
4. 导出分析结果

## 🚀 启动方法

### 方法1: 直接运行

```bash
cd Frontend
streamlit run analyzer.py --server.maxUploadSize=2048
```

### 方法2: 使用Python模块

```bash
cd Frontend
python -m streamlit run analyzer.py --server.maxUploadSize=2048
```

## 📖 使用流程

### 1. 准备NPZ文件

首先使用 `app.py` 处理视频并生成npz文件，或者使用已有的npz文件。

### 2. 上传文件

- 在分析界面中点击"选择NPZ文件"
- 选择Frontend生成的npz文件
- 系统会自动显示文件信息

### 3. 配置参数（可选）

在侧边栏可以调整：
- **低截止频率**: 带通滤波器的低截止频率（默认0.2 Hz）
- **高截止频率**: 带通滤波器的高截止频率（默认5.0 Hz）
- **主频搜索范围**: 主频搜索的最小值和最大值
- **异常检测阈值**: 可选的峰峰值和RMS阈值

### 4. 开始分析

点击"🚀 开始分析"按钮，系统会：
1. 加载npz文件
2. 执行图像分析（提取位移序列）
3. 执行信号分析（切向和轴向）
4. 生成可视化结果

### 5. 查看结果

分析完成后会显示：
- **关键指标**: 主频、峰峰值等
- **时域图**: 切向和轴向位移时间序列
- **频域图**: 频谱分析和主频标记
- **详细统计**: 完整的分析数据
- **导出功能**: 可导出CSV格式的统计数据

## 📊 结果说明

### 关键指标

- **切向主频**: 切向方向的主要振动频率
- **切向峰峰值**: 切向方向的最大位移幅度
- **轴向主频**: 轴向方向的主要振动频率
- **轴向峰峰值**: 轴向方向的最大位移幅度

### 时域图

显示位移随时间的变化，包括：
- 切向位移时间序列
- 轴向位移时间序列

### 频域图

显示频谱分析结果，包括：
- 频谱曲线
- 主频标记（红色/蓝色虚线）

### 异常检测

如果启用了异常检测阈值，系统会自动判断：
- 峰峰值是否超过阈值
- RMS是否超过阈值
- 如果超过，会显示警告信息

## ⚙️ 配置要求

### Backend连接

确保Backend模块可以正常导入：
- `Backend/WindVibAnalysis/main_workflow.py` 中的 `run_image_analysis_from_npz`
- `Backend/signal.py` 中的 `DisplacementSeries` 和 `analyze_displacement_series`

### 配置文件

Backend需要配置文件：
- `Backend/WindVibAnalysis/config/camera_params.json`

### 依赖包

确保已安装所有依赖：
```bash
pip install -r requirements.txt
```

## 🔧 故障排除

### 问题1: Backend未连接

**症状**: 显示"Backend未完全连接"

**解决方法**:
1. 检查Backend路径是否正确
2. 确保Backend模块文件存在
3. 检查配置文件是否存在

### 问题2: 分析失败

**症状**: 分析过程中报错

**解决方法**:
1. 检查npz文件格式是否正确（必须包含frames和fps）
2. 检查Backend配置文件是否正确
3. 查看详细错误信息（点击展开错误详情）

### 问题3: 图表不显示

**症状**: 分析完成但图表空白

**解决方法**:
1. 检查matplotlib是否正确安装
2. 确保数据不为空
3. 刷新页面重试

## 💡 使用技巧

1. **参数调整**: 根据实际需求调整滤波频率和搜索范围
2. **异常检测**: 根据历史数据设置合理的阈值
3. **结果导出**: 定期导出CSV文件保存分析结果
4. **多次分析**: 可以对同一个npz文件进行多次分析，调整参数对比结果

## 📝 注意事项

- npz文件必须由Frontend生成，包含frames和fps两个键
- 分析过程可能需要一些时间，请耐心等待
- 大文件分析可能需要较多内存
- 建议在处理前关闭其他占用内存的程序

